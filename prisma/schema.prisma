// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
}

model City {
  city_id      Int      @id @default(autoincrement())
  name         String   @db.VarChar(100)
  code         String?  @db.VarChar(20)

  incidents    Incident[]

  @@map("cities")
}

model Category {
  category_id  Int      @id @default(autoincrement())
  name         String   @db.VarChar(100)
  description  String?  @db.Text

  incidents    Incident[]

  @@map("categories")
}

model Status {
  status_id    Int      @id @default(autoincrement())
  name         String   @db.VarChar(50)
  description  String   @db.VarChar(150)

  incidents    Incident[]

  @@map("statuses")
}

model User {
  user_id          Int        @id @default(autoincrement())
  username         String     @db.VarChar(50)
  email            String     @unique @db.VarChar(100)
  password_hash    String     @db.VarChar(255)
  profile_pic_url  String?    @db.VarChar(255)
  is_verified      Boolean    @default(false)
  role             String     @default("CITIZEN")
  created_at       DateTime   @default(now())

  incidents        Incident[]

  @@map("users")
}

model Incident {
  incident_id      Int         @id @default(autoincrement())
  
  user_id          Int
  category_id      Int
  status_id        Int         @default(1)
  city_id          Int? 
  latitude         Decimal     @db.Decimal(10, 8)
  longitude        Decimal     @db.Decimal(11, 8)
  description      String?     @db.Text
  photo_url        String?     @db.VarChar(255)
  address_ref      String?     @db.VarChar(200)
  created_at       DateTime    @default(now())
  updated_at       DateTime    @updatedAt
  
  user             User        @relation(fields: [user_id], references: [user_id])
  category         Category    @relation(fields: [category_id], references: [category_id])
  status           Status      @relation(fields: [status_id], references: [status_id])
  city             City?       @relation(fields: [city_id], references: [city_id])
  
  @@map("incidents")
}